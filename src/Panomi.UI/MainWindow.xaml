<?xml version="1.0" encoding="utf-8"?>
<Window
    x:Class="Panomi.UI.MainWindow"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:local="using:Panomi.UI"
    Title="PANOMI">

    <Grid Background="#000000" XYFocusKeyboardNavigation="Enabled">
        <Grid.ColumnDefinitions>
            <ColumnDefinition Width="*"/>
            <ColumnDefinition Width="14"/>
        </Grid.ColumnDefinitions>
        
        <!-- Main Content -->
        <ScrollViewer x:Name="MainScrollViewer" Grid.Column="0" 
                      VerticalScrollBarVisibility="Hidden"
                      HorizontalScrollBarVisibility="Disabled"
                      HorizontalContentAlignment="Stretch"
                      ViewChanged="MainScrollViewer_ViewChanged">
            <Grid Margin="24,24,24,24" HorizontalAlignment="Stretch" XYFocusKeyboardNavigation="Enabled">
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="*"/>
                </Grid.RowDefinitions>

                <!-- Header Section -->
                <Grid Grid.Row="0" Margin="0,16,0,24">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="Auto"/>
                    </Grid.ColumnDefinitions>

                    <!-- Logo and Buttons -->
                    <StackPanel Grid.Column="0" VerticalAlignment="Top">
                        <Image Source="Assets/logo_png.png" Width="120" Height="120" HorizontalAlignment="Left" Margin="-4,0,0,16"/>
                        
                        <StackPanel Orientation="Horizontal" Spacing="12">
                            <Button x:Name="ScanButton" Click="ScanButton_Click" 
                                    Style="{StaticResource DarkRectButtonStyle}">
                                <TextBlock x:Name="ScanButtonText" FontSize="14"/>
                            </Button>
                            <Button x:Name="SpotifyButton" Click="SpotifyButton_Click"
                                    Style="{StaticResource DarkRectButtonStyle}">
                                <TextBlock Text="Spotify" FontSize="14"/>
                            </Button>
                            <Button x:Name="DiscordButton" Click="DiscordButton_Click"
                                    Height="44" Padding="10,0" CornerRadius="10"
                                    Style="{StaticResource DarkRectButtonStyle}">
                                <Grid>
                                    <Image x:Name="DiscordIcon" Width="24" Height="24"/>
                                    <TextBlock x:Name="DiscordFallbackText" Text="Discord" FontSize="14" 
                                               Foreground="White" VerticalAlignment="Center"
                                               Visibility="Collapsed"/>
                                </Grid>
                            </Button>
                            <Button x:Name="AILinksButton"
                                    Width="44" Height="44" Padding="0" CornerRadius="10"
                                    Style="{StaticResource DarkRectButtonStyle}">
                                <TextBlock Text="AI" FontSize="16" FontWeight="Bold" Foreground="White"/>
                                <Button.Flyout>
                                    <MenuFlyout Placement="BottomEdgeAlignedLeft">
                                        <MenuFlyout.MenuFlyoutPresenterStyle>
                                            <Style TargetType="MenuFlyoutPresenter">
                                                <Setter Property="Background" Value="#0f1114"/>
                                                <Setter Property="BorderBrush" Value="#2a2a2f"/>
                                                <Setter Property="BorderThickness" Value="1"/>
                                                <Setter Property="Padding" Value="4"/>
                                                <Setter Property="CornerRadius" Value="8"/>
                                            </Style>
                                        </MenuFlyout.MenuFlyoutPresenterStyle>
                                        <MenuFlyoutItem x:Name="AIChatGPT" Text="ChatGPT" Click="WebLink_Click" Tag="https://chat.openai.com" Foreground="White"/>
                                        <MenuFlyoutItem x:Name="AIClaude" Text="Claude" Click="WebLink_Click" Tag="https://claude.ai" Foreground="White"/>
                                        <MenuFlyoutItem x:Name="AICopilot" Text="Copilot" Click="WebLink_Click" Tag="https://copilot.microsoft.com" Foreground="White"/>
                                        <MenuFlyoutItem x:Name="AIDeepSeek" Text="DeepSeek" Click="WebLink_Click" Tag="https://chat.deepseek.com" Foreground="White"/>
                                        <MenuFlyoutItem x:Name="AIGemini" Text="Gemini" Click="WebLink_Click" Tag="https://gemini.google.com" Foreground="White"/>
                                        <MenuFlyoutItem x:Name="AIGrok" Text="Grok" Click="WebLink_Click" Tag="https://grok.x.ai" Foreground="White"/>
                                        <MenuFlyoutItem x:Name="AIMetaAI" Text="Meta AI" Click="WebLink_Click" Tag="https://meta.ai" Foreground="White"/>
                                    </MenuFlyout>
                                </Button.Flyout>
                            </Button>
                            <Button x:Name="WebLinksButton"
                                    Width="44" Height="44" Padding="0" CornerRadius="10"
                                    Style="{StaticResource DarkRectButtonStyle}">
                                <FontIcon Glyph="&#xE774;" FontSize="20" Foreground="White"/>
                                <Button.Flyout>
                                    <MenuFlyout Placement="BottomEdgeAlignedLeft">
                                        <MenuFlyout.MenuFlyoutPresenterStyle>
                                            <Style TargetType="MenuFlyoutPresenter">
                                                <Setter Property="Background" Value="#0f1114"/>
                                                <Setter Property="BorderBrush" Value="#2a2a2f"/>
                                                <Setter Property="BorderThickness" Value="1"/>
                                                <Setter Property="Padding" Value="4"/>
                                                <Setter Property="CornerRadius" Value="8"/>
                                            </Style>
                                        </MenuFlyout.MenuFlyoutPresenterStyle>
                                        
                                        <!-- Chinese Platforms (only visible for zh-CN) -->
                                        <MenuFlyoutSubItem x:Name="WebChineseMenu" Text="Chinese Platforms" Foreground="White" Visibility="Collapsed">
                                            <MenuFlyoutItem x:Name="WebBaidu" Text="Baidu Tieba" Click="WebLink_Click" Tag="https://tieba.baidu.com" Foreground="White"/>
                                            <MenuFlyoutItem x:Name="WebBilibili" Text="Bilibili" Click="WebLink_Click" Tag="https://www.bilibili.com" Foreground="White"/>
                                            <MenuFlyoutItem x:Name="WebDouyin" Text="Douyin" Click="WebLink_Click" Tag="https://www.douyin.com" Foreground="White"/>
                                            <MenuFlyoutItem x:Name="WebIQIYI" Text="iQIYI" Click="WebLink_Click" Tag="https://www.iqiyi.com" Foreground="White"/>
                                            <MenuFlyoutItem x:Name="WebMangoTV" Text="Mango TV" Click="WebLink_Click" Tag="https://www.mgtv.com" Foreground="White"/>
                                            <MenuFlyoutItem x:Name="WebTencentVideo" Text="Tencent Video" Click="WebLink_Click" Tag="https://v.qq.com" Foreground="White"/>
                                            <MenuFlyoutItem x:Name="WebWeChat" Text="WeChat" Click="WebLink_Click" Tag="https://weixin.qq.com" Foreground="White"/>
                                            <MenuFlyoutItem x:Name="WebWeibo" Text="Weibo" Click="WebLink_Click" Tag="https://weibo.com" Foreground="White"/>
                                            <MenuFlyoutItem x:Name="WebXiaohongshu" Text="Xiaohongshu" Click="WebLink_Click" Tag="https://www.xiaohongshu.com" Foreground="White"/>
                                            <MenuFlyoutItem x:Name="WebYouku" Text="Youku" Click="WebLink_Click" Tag="https://www.youku.com" Foreground="White"/>
                                        </MenuFlyoutSubItem>
                                        
                                        <!-- Console (alphabetical) -->
                                        <MenuFlyoutSubItem x:Name="WebConsoleMenu" Text="Console" Foreground="White">
                                            <MenuFlyoutItem x:Name="WebNintendo" Text="Nintendo" Click="WebLink_Click" Tag="https://www.nintendo.com" Foreground="White"/>
                                            <MenuFlyoutItem x:Name="WebPlayStation" Text="PlayStation" Click="WebLink_Click" Tag="https://www.playstation.com" Foreground="White"/>
                                            <MenuFlyoutItem x:Name="WebXbox" Text="Xbox" Click="WebLink_Click" Tag="https://www.xbox.com" Foreground="White"/>
                                        </MenuFlyoutSubItem>
                                        
                                        <!-- Live Streaming (alphabetical) -->
                                        <MenuFlyoutSubItem x:Name="WebLiveStreamingMenu" Text="Live Streaming" Foreground="White">
                                            <MenuFlyoutItem x:Name="WebKick" Text="Kick" Click="WebLink_Click" Tag="https://www.kick.com" Foreground="White"/>
                                            <MenuFlyoutItem x:Name="WebRumble" Text="Rumble" Click="WebLink_Click" Tag="https://www.rumble.com" Foreground="White"/>
                                            <MenuFlyoutItem x:Name="WebTwitch" Text="Twitch" Click="WebLink_Click" Tag="https://www.twitch.tv" Foreground="White"/>
                                        </MenuFlyoutSubItem>
                                        
                                        <!-- Misc (alphabetical) -->
                                        <MenuFlyoutSubItem x:Name="WebMiscMenu" Text="Misc" Foreground="White">
                                            <MenuFlyoutItem x:Name="WebGitHub" Text="GitHub" Click="WebLink_Click" Tag="https://www.github.com" Foreground="White"/>
                                            <MenuFlyoutItem x:Name="WebGoogle" Text="Google" Click="WebLink_Click" Tag="https://www.google.com" Foreground="White"/>
                                            <MenuFlyoutItem x:Name="WebItchIo" Text="itch.io" Click="WebLink_Click" Tag="https://itch.io" Foreground="White"/>
                                            <MenuFlyoutItem x:Name="WebWikipedia" Text="Wikipedia" Click="WebLink_Click" Tag="https://www.wikipedia.org" Foreground="White"/>
                                            <MenuFlyoutSubItem x:Name="WebBooksMenu" Text="Books" Foreground="White">
                                                <MenuFlyoutItem x:Name="WebAudible" Text="Audible" Click="WebLink_Click" Tag="https://www.audible.com" Foreground="White"/>
                                                <MenuFlyoutItem x:Name="WebKindle" Text="Kindle" Click="WebLink_Click" Tag="https://read.amazon.com" Foreground="White"/>
                                                <MenuFlyoutItem x:Name="WebMarvelComics" Text="Marvel Comics" Click="WebLink_Click" Tag="https://www.marvel.com/comics" Foreground="White"/>
                                            </MenuFlyoutSubItem>
                                            <MenuFlyoutSubItem x:Name="WebFilmDatabasesMenu" Text="Film Databases" Foreground="White">
                                                <MenuFlyoutItem x:Name="WebBoxOfficeMojo" Text="Box Office Mojo" Click="WebLink_Click" Tag="https://www.boxofficemojo.com" Foreground="White"/>
                                                <MenuFlyoutItem x:Name="WebIMDB" Text="IMDB" Click="WebLink_Click" Tag="https://www.imdb.com" Foreground="White"/>
                                                <MenuFlyoutItem x:Name="WebLetterboxd" Text="Letterboxd" Click="WebLink_Click" Tag="https://letterboxd.com" Foreground="White"/>
                                                <MenuFlyoutItem x:Name="WebMetacritic" Text="Metacritic" Click="WebLink_Click" Tag="https://www.metacritic.com" Foreground="White"/>
                                                <MenuFlyoutItem x:Name="WebRottenTomatoes" Text="Rotten Tomatoes" Click="WebLink_Click" Tag="https://www.rottentomatoes.com" Foreground="White"/>
                                            </MenuFlyoutSubItem>
                                        </MenuFlyoutSubItem>
                                        
                                        <!-- PC (alphabetical) -->
                                        <MenuFlyoutSubItem x:Name="WebPCMenu" Text="PC" Foreground="White">
                                            <MenuFlyoutItem x:Name="WebPCPartPicker" Text="PCPartPicker" Click="WebLink_Click" Tag="https://pcpartpicker.com" Foreground="White"/>
                                        </MenuFlyoutSubItem>
                                        
                                        <!-- Social Media (alphabetical) -->
                                        <MenuFlyoutSubItem x:Name="WebSocialMediaMenu" Text="Social Media" Foreground="White">
                                            <MenuFlyoutItem x:Name="WebFacebook" Text="Facebook" Click="WebLink_Click" Tag="https://www.facebook.com" Foreground="White"/>
                                            <MenuFlyoutItem x:Name="WebInstagram" Text="Instagram" Click="WebLink_Click" Tag="https://www.instagram.com" Foreground="White"/>
                                            <MenuFlyoutItem x:Name="WebTikTok" Text="TikTok" Click="WebLink_Click" Tag="https://www.tiktok.com" Foreground="White"/>
                                            <MenuFlyoutItem x:Name="WebX" Text="X" Click="WebLink_Click" Tag="https://www.x.com" Foreground="White"/>
                                            <MenuFlyoutItem x:Name="WebYouTube" Text="YouTube" Click="WebLink_Click" Tag="https://www.youtube.com" Foreground="White"/>
                                            <MenuFlyoutSubItem x:Name="WebSocialMediaOtherMenu" Text="Other" Foreground="White">
                                                <MenuFlyoutItem x:Name="WebMessenger" Text="Messenger" Click="WebLink_Click" Tag="https://www.messenger.com" Foreground="White"/>
                                                <MenuFlyoutItem x:Name="WebPinterest" Text="Pinterest" Click="WebLink_Click" Tag="https://www.pinterest.com" Foreground="White"/>
                                                <MenuFlyoutItem x:Name="WebReddit" Text="Reddit" Click="WebLink_Click" Tag="https://www.reddit.com" Foreground="White"/>
                                                <MenuFlyoutItem x:Name="WebSnapchat" Text="Snapchat" Click="WebLink_Click" Tag="https://www.snapchat.com" Foreground="White"/>
                                                <MenuFlyoutItem x:Name="WebTelegram" Text="Telegram" Click="WebLink_Click" Tag="https://web.telegram.org" Foreground="White"/>
                                                <MenuFlyoutItem x:Name="WebThreads" Text="Threads" Click="WebLink_Click" Tag="https://www.threads.net" Foreground="White"/>
                                                <MenuFlyoutItem x:Name="WebWhatsApp" Text="WhatsApp" Click="WebLink_Click" Tag="https://web.whatsapp.com" Foreground="White"/>
                                            </MenuFlyoutSubItem>
                                        </MenuFlyoutSubItem>
                                        
                                        <!-- TV Streaming (alphabetical) -->
                                        <MenuFlyoutSubItem x:Name="WebTVStreamingMenu" Text="TV Streaming" Foreground="White">
                                            <MenuFlyoutItem x:Name="WebAmazonPrime" Text="Amazon Prime" Click="WebLink_Click" Tag="https://www.primevideo.com" Foreground="White"/>
                                            <MenuFlyoutItem x:Name="WebAppleTV" Text="Apple TV+" Click="WebLink_Click" Tag="https://tv.apple.com" Foreground="White"/>
                                            <MenuFlyoutItem x:Name="WebDisneyPlus" Text="Disney+" Click="WebLink_Click" Tag="https://www.disneyplus.com" Foreground="White"/>
                                            <MenuFlyoutItem x:Name="WebNetflix" Text="Netflix" Click="WebLink_Click" Tag="https://www.netflix.com" Foreground="White"/>
                                        </MenuFlyoutSubItem>
                                        
                                        <!-- Stores -->
                                        <MenuFlyoutSubItem x:Name="WebStoresMenu" Text="Stores" Foreground="White">
                                            <MenuFlyoutSubItem x:Name="WebStoresAmazonMenu" Text="Amazon" Foreground="White">
                                                <MenuFlyoutItem x:Name="WebAmazonUK" Text="Amazon UK" Click="WebLink_Click" Tag="https://www.amazon.co.uk?tag=panomiuk-21" Foreground="White"/>
                                                <MenuFlyoutItem x:Name="WebAmazonUS" Text="Amazon US" Click="WebLink_Click" Tag="https://www.amazon.com?tag=panomi-20" Foreground="White"/>
                                            </MenuFlyoutSubItem>
                                            <MenuFlyoutSubItem x:Name="WebStoresGamesMenu" Text="Games" Foreground="White">
                                                <MenuFlyoutItem x:Name="WebFanatical" Text="Fanatical" Click="WebLink_Click" Tag="https://www.fanatical.com" Foreground="White"/>
                                                <MenuFlyoutItem x:Name="WebGMG" Text="GMG" Click="WebLink_Click" Tag="https://www.greenmangaming.com" Foreground="White"/>
                                                <MenuFlyoutItem x:Name="WebHumbleBundle" Text="Humble Bundle" Click="WebLink_Click" Tag="https://www.humblebundle.com" Foreground="White"/>
                                            </MenuFlyoutSubItem>
                                        </MenuFlyoutSubItem>
                                        
                                        <!-- Support -->
                                        <MenuFlyoutSubItem x:Name="WebSupportMenu" Text="Support" Foreground="White">
                                            <MenuFlyoutItem x:Name="WebLinktree" Text="Linktree" Click="WebLink_Click" Tag="https://linktr.ee/panomiltd" Foreground="White"/>
                                        </MenuFlyoutSubItem>
                                        
                                    </MenuFlyout>
                                </Button.Flyout>
                            </Button>
                            <Button x:Name="UpdateButton" Click="UpdateButton_Click"
                                    Visibility="Collapsed"
                                    Style="{StaticResource DarkRectButtonStyle}">
                                <TextBlock x:Name="UpdateButtonText" FontSize="14" Foreground="#4ade80"/>
                            </Button>
                        </StackPanel>
                    </StackPanel>

                    <!-- Stats -->
                    <StackPanel Grid.Column="1" Orientation="Horizontal" Spacing="16" VerticalAlignment="Top" Margin="0,16,0,0">
                        <Border Background="#0f1114" CornerRadius="12" Padding="24,16" MinWidth="110">
                            <StackPanel>
                                <TextBlock x:Name="StatTotalLabel" Foreground="#888" FontSize="13"/>
                                <TextBlock x:Name="TotalCount" Text="0" Foreground="White" FontSize="32" FontWeight="Bold"/>
                            </StackPanel>
                        </Border>
                        <Border Background="#0f1114" CornerRadius="12" Padding="24,16" MinWidth="110">
                            <StackPanel>
                                <TextBlock x:Name="StatLaunchersLabel" Foreground="#888" FontSize="13"/>
                                <TextBlock x:Name="LauncherCount" Text="0" Foreground="White" FontSize="32" FontWeight="Bold"/>
                            </StackPanel>
                        </Border>
                        <Border Background="#0f1114" CornerRadius="12" Padding="24,16" MinWidth="110">
                            <StackPanel>
                                <TextBlock x:Name="StatGamesLabel" Foreground="#888" FontSize="13"/>
                                <TextBlock x:Name="GameCount" Text="0" Foreground="White" FontSize="32" FontWeight="Bold"/>
                            </StackPanel>
                        </Border>
                    </StackPanel>
                </Grid>

                <!-- Search and Filter -->
                <Grid Grid.Row="1" Margin="0,0,0,24">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="Auto"/>
                    </Grid.ColumnDefinitions>

                    <TextBox x:Name="SearchBox" 
                             PlaceholderText="" 
                             Background="#0f1114" 
                             Foreground="White"
                             BorderBrush="#1a1a1f"
                             Padding="16,12"
                             TextChanged="SearchBox_TextChanged"
                             HorizontalAlignment="Stretch"/>

                    <StackPanel Grid.Column="1" Orientation="Horizontal" Spacing="8" Margin="16,0,0,0">
                        <Button x:Name="FilterAll" Click="FilterAll_Click"
                                Style="{StaticResource CyanPillButtonStyle}"/>
                        <Button x:Name="FilterLaunchers" Click="FilterLaunchers_Click"
                                Style="{StaticResource DarkPillButtonStyle}"/>
                        <Button x:Name="FilterGames" Click="FilterGames_Click"
                                Style="{StaticResource DarkPillButtonStyle}"/>
                        <Button x:Name="SourceFilterButton"
                                Style="{StaticResource DarkPillButtonStyle}">
                            <Button.Flyout>
                                <Flyout x:Name="SourceFilterFlyout" Placement="BottomEdgeAlignedRight">
                                    <Flyout.FlyoutPresenterStyle>
                                        <Style TargetType="FlyoutPresenter">
                                            <Setter Property="Background" Value="#0f1114"/>
                                            <Setter Property="BorderBrush" Value="#2a2a2f"/>
                                            <Setter Property="BorderThickness" Value="1"/>
                                            <Setter Property="Padding" Value="8"/>
                                            <Setter Property="CornerRadius" Value="8"/>
                                        </Style>
                                    </Flyout.FlyoutPresenterStyle>
                                    <StackPanel x:Name="SourceFilterPanel" MinWidth="180" Spacing="4" XYFocusKeyboardNavigation="Enabled"/>
                                </Flyout>
                            </Button.Flyout>
                        </Button>
                        <Button x:Name="FilterFavorites" Click="FilterFavorites_Click"
                                Width="40" Height="40" Padding="0" CornerRadius="20"
                                Style="{StaticResource DarkPillButtonStyle}">
                            <FontIcon x:Name="FavoritesIcon" Glyph="&#xE734;" FontSize="16" Foreground="White"/>
                        </Button>
                        <Button x:Name="SettingsButton"
                                Width="40" Height="40" Padding="0" CornerRadius="20"
                                Style="{StaticResource DarkPillButtonStyle}">
                            <Button.Flyout>
                                <Flyout x:Name="SettingsFlyout" Placement="BottomEdgeAlignedRight">
                                    <Flyout.FlyoutPresenterStyle>
                                        <Style TargetType="FlyoutPresenter">
                                            <Setter Property="Background" Value="#0f1114"/>
                                            <Setter Property="BorderBrush" Value="#2a2a2f"/>
                                            <Setter Property="BorderThickness" Value="1"/>
                                            <Setter Property="Padding" Value="8"/>
                                            <Setter Property="CornerRadius" Value="8"/>
                                        </Style>
                                    </Flyout.FlyoutPresenterStyle>
                                    <StackPanel MinWidth="180" Spacing="4" XYFocusKeyboardNavigation="Enabled">
                                        <Grid x:Name="FullscreenRow" Padding="4,6,4,6" 
                                              Background="Transparent" PointerPressed="FullscreenRow_PointerPressed">
                                            <Grid.ColumnDefinitions>
                                                <ColumnDefinition Width="*"/>
                                                <ColumnDefinition Width="Auto"/>
                                            </Grid.ColumnDefinitions>
                                            <TextBlock x:Name="FullscreenText" Foreground="White" VerticalAlignment="Center"/>
                                            <CheckBox x:Name="FullscreenToggle" Grid.Column="1" 
                                                      Checked="FullscreenToggle_Changed" Unchecked="FullscreenToggle_Changed"
                                                      KeyDown="SettingsCheckbox_KeyDown"
                                                      MinWidth="0" Padding="0"/>
                                        </Grid>
                                        
                                        <Grid x:Name="StartupRow" Padding="4,6,4,6" 
                                              Background="Transparent" PointerPressed="StartupRow_PointerPressed">
                                            <Grid.ColumnDefinitions>
                                                <ColumnDefinition Width="*"/>
                                                <ColumnDefinition Width="Auto"/>
                                            </Grid.ColumnDefinitions>
                                            <TextBlock x:Name="StartupText" Foreground="White" VerticalAlignment="Center"/>
                                            <CheckBox x:Name="StartupToggle" Grid.Column="1" 
                                                      Checked="StartupToggle_Changed" Unchecked="StartupToggle_Changed"
                                                      KeyDown="SettingsCheckbox_KeyDown"
                                                      MinWidth="0" Padding="0"/>
                                        </Grid>
                                        
                                        <Grid x:Name="MinimizeToTrayRow" Padding="4,6,4,6" 
                                              Background="Transparent" PointerPressed="MinimizeToTrayRow_PointerPressed"
                                              ToolTipService.Placement="Left">
                                            <ToolTipService.ToolTip>
                                                <ToolTip x:Name="QuickLaunchTooltip" Background="#0f1114" BorderBrush="#2a2a2f" BorderThickness="1" CornerRadius="8" Padding="12,8">
                                                    <TextBlock x:Name="QuickLaunchInfoText" Foreground="White" FontSize="12" MaxWidth="250" TextWrapping="Wrap"/>
                                                </ToolTip>
                                            </ToolTipService.ToolTip>
                                            <Grid.ColumnDefinitions>
                                                <ColumnDefinition Width="*"/>
                                                <ColumnDefinition Width="Auto"/>
                                            </Grid.ColumnDefinitions>
                                            <TextBlock x:Name="MinimizeToTrayText" Foreground="White" VerticalAlignment="Center"/>
                                            <CheckBox x:Name="MinimizeToTrayToggle" Grid.Column="1" 
                                                      Checked="MinimizeToTrayToggle_Changed" Unchecked="MinimizeToTrayToggle_Changed"
                                                      KeyDown="SettingsCheckbox_KeyDown"
                                                      GotFocus="QuickLaunchToggle_GotFocus" LostFocus="QuickLaunchToggle_LostFocus"
                                                      MinWidth="0" Padding="0"/>
                                        </Grid>
                                        
                                        <!-- Language Selector -->
                                        <Button x:Name="LanguageButton" 
                                                HorizontalAlignment="Stretch" 
                                                HorizontalContentAlignment="Left"
                                                Background="Transparent" 
                                                Foreground="White" 
                                                Padding="0,6,4,6"
                                                BorderThickness="0">
                                            <Button.Content>
                                                <StackPanel Orientation="Horizontal" Spacing="4">
                                                    <TextBlock Text="ðŸŒ" FontSize="16" VerticalAlignment="Center"/>
                                                    <TextBlock x:Name="LanguageText" Text="Language" Foreground="White" VerticalAlignment="Center"/>
                                                </StackPanel>
                                            </Button.Content>
                                            <Button.Flyout>
                                                <Flyout x:Name="LanguageFlyout" Placement="Left" Closed="LanguageFlyout_Closed">
                                                    <Flyout.FlyoutPresenterStyle>
                                                        <Style TargetType="FlyoutPresenter">
                                                            <Setter Property="Background" Value="#0f1114"/>
                                                            <Setter Property="BorderBrush" Value="#2a2a2f"/>
                                                            <Setter Property="BorderThickness" Value="1"/>
                                                            <Setter Property="Padding" Value="8,8,0,8"/>
                                                            <Setter Property="CornerRadius" Value="8"/>
                                                            <Setter Property="MaxHeight" Value="800"/>
                                                            <Setter Property="ScrollViewer.VerticalScrollBarVisibility" Value="Disabled"/>
                                                            <Setter Property="ScrollViewer.HorizontalScrollBarVisibility" Value="Disabled"/>
                                                        </Style>
                                                    </Flyout.FlyoutPresenterStyle>
                                                    <Grid>
                                                        <Grid.ColumnDefinitions>
                                                            <ColumnDefinition Width="*"/>
                                                            <ColumnDefinition Width="8"/>
                                                        </Grid.ColumnDefinitions>
                                                        <ScrollViewer x:Name="LanguageScrollViewer" Grid.Column="0" VerticalScrollBarVisibility="Hidden" MaxHeight="750" ViewChanged="LanguageScrollViewer_ViewChanged">
                                                            <StackPanel x:Name="LanguagePanel" MinWidth="120" Spacing="2" XYFocusKeyboardNavigation="Enabled"/>
                                                        </ScrollViewer>
                                                        <Grid x:Name="LanguageScrollTrack" Grid.Column="1" Background="#1a1a1f" CornerRadius="4"
                                                              PointerPressed="LanguageScrollTrack_PointerPressed">
                                                            <Border x:Name="LanguageScrollThumb" 
                                                                    Background="#666666" 
                                                                    CornerRadius="4"
                                                                    VerticalAlignment="Top"
                                                                    Height="50"
                                                                    Margin="1"
                                                                    PointerPressed="LanguageScrollThumb_PointerPressed"
                                                                    PointerMoved="LanguageScrollThumb_PointerMoved"
                                                                    PointerReleased="LanguageScrollThumb_PointerReleased"
                                                                    PointerCaptureLost="LanguageScrollThumb_PointerReleased"/>
                                                        </Grid>
                                                    </Grid>
                                                </Flyout>
                                            </Button.Flyout>
                                        </Button>
                                    </StackPanel>
                                </Flyout>
                            </Button.Flyout>
                            <FontIcon x:Name="SettingsIcon" Glyph="&#xE713;" FontSize="16" Foreground="White"/>
                        </Button>
                    </StackPanel>
                </Grid>

                <!-- Library Header -->
                <Grid Grid.Row="2" Margin="0,0,0,16">
                    <TextBlock x:Name="LibraryHeader" FontSize="24" FontWeight="Bold" Foreground="White"/>
                </Grid>

                <!-- Cards Grid - responsive layout -->
                <ItemsRepeater x:Name="CardsGrid" Grid.Row="3" HorizontalAlignment="Stretch">
                    <ItemsRepeater.Layout>
                        <UniformGridLayout Orientation="Horizontal" 
                                           MinItemWidth="300"
                                           MinItemHeight="56"
                                           MinRowSpacing="8"
                                           MinColumnSpacing="16"
                                           ItemsStretch="Fill"
                                           ItemsJustification="Start"/>
                    </ItemsRepeater.Layout>
                    <ItemsRepeater.ItemTemplate>
                        <DataTemplate>
                            <Border CornerRadius="12" Background="#0f1114" Padding="12,8">
                                <Grid>
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="Auto"/>
                                        <ColumnDefinition Width="*"/>
                                        <ColumnDefinition Width="Auto"/>
                                        <ColumnDefinition Width="Auto"/>
                                    </Grid.ColumnDefinitions>
                                    
                                    <!-- Icon column -->
                                    <Grid Grid.Column="0" VerticalAlignment="Center" Margin="0,0,10,0">
                                        <!-- Launcher icon (native, no border) -->
                                        <Image Source="{Binding LauncherIcon}" Width="28" Height="28"
                                               Visibility="{Binding HasLauncherIcon, Converter={StaticResource BoolToVisibilityConverter}}"/>
                                        <!-- Rounded square icon for games -->
                                        <Border Width="28" Height="28" CornerRadius="6"
                                                Visibility="{Binding GameIcon, Converter={StaticResource NullToCollapsedConverter}}">
                                            <Border.Background>
                                                <ImageBrush ImageSource="{Binding GameIcon}" Stretch="UniformToFill"/>
                                            </Border.Background>
                                        </Border>
                                        <!-- Panomi logo fallback -->
                                        <Grid Width="28" Height="28" CornerRadius="6"
                                              Visibility="{Binding ShowFallbackIcon, Converter={StaticResource BoolToVisibilityConverter}}">
                                            <Image Source="ms-appx:///Assets/logo_png.png" Stretch="UniformToFill"/>
                                        </Grid>
                                        <FontIcon Glyph="{Binding TitleGlyph}" FontSize="18" Foreground="White"
                                                  Visibility="{Binding HasTitleGlyph, Converter={StaticResource BoolToVisibilityConverter}}"/>
                                    </Grid>
                                    
                                    <!-- Title column -->
                                    <StackPanel Grid.Column="1" VerticalAlignment="Center" Margin="0,0,8,0">
                                        <TextBlock Text="{Binding Name}" Foreground="White" 
                                                   FontSize="14" FontWeight="SemiBold"
                                                   TextTrimming="CharacterEllipsis" MaxLines="1"
                                                   Loaded="GameName_Loaded"
                                                   SizeChanged="GameName_SizeChanged"/>
                                        <TextBlock Text="{Binding LauncherName}" Foreground="#888" 
                                                   FontSize="11"
                                                   Visibility="{Binding HasMultipleLaunchers, Converter={StaticResource BoolToVisibilityConverter}}"/>
                                    </StackPanel>
                                    
                                    <!-- Play button -->
                                    <Button x:Name="LaunchButton"
                                            Click="LaunchItem_Click"
                                            Tag="{Binding}"
                                            Grid.Column="2"
                                            Width="36" Height="36"
                                            Padding="0"
                                            CornerRadius="8"
                                            Style="{StaticResource CyanLaunchButtonStyle}"
                                            Margin="0,0,6,0">
                                        <FontIcon Glyph="&#xE768;" FontSize="14"/>
                                    </Button>
                                    
                                    <!-- Favorite button -->
                                    <Button Click="FavoriteItem_Click"
                                            Tag="{Binding}"
                                            Grid.Column="3"
                                            Width="36" Height="36"
                                            Padding="0"
                                            CornerRadius="8"
                                            Background="#1a1a1f">
                                        <FontIcon Glyph="{Binding FavoriteIcon}" 
                                                  FontSize="16"
                                                  Foreground="{Binding IsFavorite, Converter={StaticResource BoolToFavoriteColorConverter}}"/>
                                    </Button>
                                </Grid>
                            </Border>
                        </DataTemplate>
                    </ItemsRepeater.ItemTemplate>
                </ItemsRepeater>

                <!-- Empty State -->
                <StackPanel x:Name="EmptyState" Grid.Row="3" 
                            HorizontalAlignment="Center" VerticalAlignment="Center"
                            Visibility="Collapsed" Margin="0,60,0,0">
                    <FontIcon Glyph="&#xE7FC;" FontSize="64" Foreground="#444"/>
                    <TextBlock Text="No items found" FontSize="20" Foreground="#666" 
                               HorizontalAlignment="Center" Margin="0,16,0,0"/>
                </StackPanel>
            </Grid>
        </ScrollViewer>

        <!-- Loading Overlay -->
        <!-- Custom Scrollbar Track and Thumb -->
        <Grid x:Name="ScrollTrack" Grid.Column="1" Background="#1a1a1f" Margin="2,8,2,8"
              PointerPressed="ScrollTrack_PointerPressed">
            <Border x:Name="ScrollThumb" 
                    Background="#666666" 
                    CornerRadius="4"
                    VerticalAlignment="Top"
                    Height="100"
                    Margin="1"
                    PointerPressed="ScrollThumb_PointerPressed"
                    PointerMoved="ScrollThumb_PointerMoved"
                    PointerReleased="ScrollThumb_PointerReleased"
                    PointerCaptureLost="ScrollThumb_PointerReleased"/>
        </Grid>
        
        <Grid x:Name="LoadingOverlay" Grid.ColumnSpan="2" Background="#DD000000" Visibility="Collapsed">
            <StackPanel HorizontalAlignment="Center" VerticalAlignment="Center">
                <ProgressRing IsActive="True" Width="48" Height="48" Foreground="#00D4AA"/>
                <TextBlock x:Name="LoadingText" Text="Scanning..." Foreground="White" 
                           Margin="0,16,0,0" FontSize="16"/>
            </StackPanel>
        </Grid>
    </Grid>
</Window>
